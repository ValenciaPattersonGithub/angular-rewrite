!function(){"use strict";var a=angular.module("PatWebCoreV1",["PatWebCore","PatCoreUtility","ngIdle"]).constant("moment",moment);a.config(["IdleProvider","INACTIVITY_TIMEOUT","INACTIVITY_AUTO_TIMEOUT","DISPLAY_AS",function(a,b,c,d){a.idle(Number(b)),a.timeout(Number(c)),window.document.Title=d}]),a.run(["$rootScope","instanceIdentifier","$uibModal","manageSession","patSecurityService","practiceService",function(a,b,c,d,e,f){d.startIdle();var g=e.getUser();_.isNullOrUndefined(g)||(_.isNullOrUndefined(g.UserName)||(window.username=g.UserName),_.isNullOrUndefined(g.UserId)||(window.userId=g.UserId)),a.$on("patCore:initpractice",function(){var a=f.getCurrentPractice();a&&(window.practiceId=a.id)}),a.$on("patwebcore:idleTimeout",function(b){var d='<div class="modal-content"><div class="modal-header"><h4 class="modal-title">Session Inactivity</h4></div><div class="modal-body"><p><div idle-countdown="countdown"  class="modal-body">You will be automatically logged out in <b>{{countdown| secondsToMinutesSeconds|date:"m:ss"}}</b> minute(s) due to inactivity.To remain logged in move your mouse over this window.</div></div><div class="modal-footer"></div></div>';a.warning=c.open({template:d,animation:!0,controller:"manageSessionModalController",windowClass:"modal-loading",backdrop:"static",keyboard:!1,scope:a})})}]),a.filter("secondsToMinutesSeconds",[function(){return function(a){return new Date(1970,0,1).setSeconds(a)}}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("appHeaderInterceptor",["applicationService",function(a){return{request:function(b){if(b.noPatHeaders===!0)return b;var c=a.getApplicationId();return b.headers["PAT-Application-ID"]=c,b}}}]),a.config(["$httpProvider",function(a){a.interceptors.push("appHeaderInterceptor")}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("directoryModel",function(){function a(a,b,c,d,e){this.DirectoryAllocationId=a,this.Name=b,this.DirectoryState=0,this.ParentDirectoryAllocationId=c,this.AccessLevel=d,this.AccessLevelParentIds=e}return a.build=function(b,c,d,e,f){return new a(b,c,d,e,f)},a})}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("directoryService",["$http","FILE_API_URL","directoryModel",function(a,b,c){function d(b){return a.post(g,b)}function e(){var b=g+"/rootdirs";return a.get(b)}function f(b){var c=g+"/"+b+"/files";return a.get(c)}var g=b+"/api/directories";return{createDirectory:d,getRootDirectories:e,getFiles:f}}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("fileModel",function(){function a(a,b,c,d,e){this.FileAllocationId=a,this.DirectoryAllocationId=b,this.FileState=c,this.Version=1,this.Filename=d,this.MimeType=e}return a.build=function(b,c,d,e,f){return new a(b,c,d,e,f)},a})}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("fileService",["$rootScope","$http","FILE_API_URL","fileModel","directoryModel",function(a,b,c,d,e){function f(a){return b.post(j,a)}function g(a,c){var d=j+"/"+a,e=new FormData;return e.append("text",c),b.post(d,e,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}function h(a){var c=j+"/content/"+a;return b.get(c)}function i(a){var c=j+"/"+a;return b.get(c)}var j=c+"/api/files";return{allocateFile:f,uploadFile:g,downloadFile:h,getMetadata:i}}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.directive("imageUpload",function(){var a='<div class="block image--upload"><div><input type="text" readonly class="image-name" ng-model="vm.imageName" ng-click="vm.getImage($event)"/><input type="button" class="image-btn" value="Browse" ng-click="vm.getImage($event)"/><input type="button" class="image-btn" value="Clear" ng-click="vm.clearImage()" ng-show="vm.showImage"/><input type="file" class="image-file" style="display:none;" accept="image/*" onchange="angular.element(this).scope().vm.setImage(this)" /></div><div ng-show="vm.message != \'\'" class="message"><span ng-show="!vm.isValid" class="error">{{vm.message}}</span><span ng-show="vm.isValid" class="success" >{{vm.message}}</span></div><div class="image-loading" ng-show="vm.showLoading" >Loading...</div><div class="image-display" ng-show="vm.showImage" ng-style="vm.loadingView"><div class="image-size" style="display:block;" >{{vm.imageWidth}}{{vm.imageSizeSpacer}}{{vm.imageHeight}}</div><div class="preview-image" ><img ng-src="{{vm.previewImage}}" /></div><div class="image-upload-container" ><input type="button" class="image-btn" value="Upload" ng-click="vm.uploadImage(vm.directory)" /></div></div></div>';return{restrict:"EA",scope:{directory:"="},controller:"imageUploadDirectiveController",controllerAs:"vm",bindToController:!0,template:a}})}(),function(){angular.module("PatWebCoreV1").controller("imageUploadDirectiveController",function(a,b){function c(){d(),i.clearImage(),g()}function d(){i.isValid=!0,i.message=""}function e(a){var b=a.name.split(".").pop().toLowerCase();return j.indexOf(b)>-1}function f(){i.loadingView={opacity:.5},i.showLoading=!0}function g(){i.loadingView={},i.showLoading=!1}function h(a){i.isValid=!1;var b="";switch(a){case 0:b="The file selected is not a supported image format, please select a valid image.";break;case 1:b="A conflict occurred while allocating the file, please contact your system administrator or rename the file and attempt to upload it again.";break;case 2:b="An error occurred while trying to upload your image please try again";break;case 3:b="Image uploaded successfully.",i.isValid=!0;break;case 4:b="An issue occurred while uploading the file after allocation, please rename your file and try again.";break;default:b="An error occurred while trying to upload your image please try again"}i.message=b}var i=this,j=["jpg","jpeg","bmp","gif","png","tif","tiff"];i.getImage=function(a){angular.element("input[type=file]").trigger("click")},i.setImage=function(b){d(),i.files=b.files;var c=b.files[0];if(i.isValid=e(c),i.isValid){i.imageName=c.name;var f=new FileReader;f.onload=function(b){a.$apply(function(){var a=new Image;a.src=f.result,i.imageWidth=a.width,i.imageSizeSpacer=" x ",i.imageHeight=a.height,i.previewImage=b.target.result,i.showImage=!0})},f.readAsDataURL(c)}else a.$apply(function(){i.clearImage(),h(0)})},i.clearImage=function(){angular.element("input[type='file']").val(null),i.files=[],i.imageName="",i.previewImage="",i.message="",i.showImage=!1},i.uploadImage=function(a){d();var c={EnterpriseId:1,DirectoryAllocationId:a,Filename:i.imageName};f(),b.allocateFile(c).then(function(a){var c=i.files[0],d=new FileReader;d.onloadend=function(){var d=new FormData;d.append("file",c),b.uploadImage(a.data.Result.FileAllocationId,d).then(function(){i.clearImage(),h(3),g()})["catch"](function(){h(4),g()})},d.readAsArrayBuffer(c)})["catch"](function(a){h(409===a.status?1:2),g()})},c()})}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("imageUploadFactory",["$http","FILE_API_URL",function(a,b){function c(b){return a.post(e,b,{})}function d(b,c){var d=e+"/"+b;return a.post(d,c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}var e=b+"/api/files";return{allocateFile:c,uploadImage:d}}])}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(){var a=b.defer(),d=!1,e=g.getSessionStorage(y);if(null===e){var f=c.addEventListener?"addEventListener":"attachEvent",h=c[f],j="attachEvent"===f?"onmessage":"message";h(j,function(b){if("Apteryx Token Process Completed"===b.data){d=!0;var c=i();a.resolve(c)}}),setTimeout(function(){return d?a.promise:b.reject(new Error("Process took longer then expected"))},2e4)}else{var k=i();a.resolve(k)}return a.promise}function i(){if("true"===d.apteryxUsePracticeIdForSiteName.toLowerCase()){var a=g.getSessionStorage("userPractice");return null!==a?a.id:(console.log("Practice was not found with practiceId mode enabled so returning default configuration value"),d.apteryxUrlSiteName)}return d.apteryxUrlSiteName}function j(){return x+i()+"."+d.apteryxUrlPart+"/"}function k(){var a=j()+"api/";return a}function l(b){var c=k()+"patient/?primaryId="+b;return a.get(c)}function m(a){return j()+"?patient="+a}function n(a){return j()+"?study="+a}function o(a,b){return n(b)}function p(a){return j()+"?image="+a}function q(b){var c=k()+"study/?patient="+b;return a.get(c)}function r(b){var c=k()+"series/?study="+b;return a.get(c)}function s(b){var c=k()+"image/?series="+b;return a.get(c)}function t(a){var c=b.defer(),d=[],e=!1;return q(a).then(function(a){var f=[];d=a.data.Records,_.forEach(d,function(a){var d=b.defer();f.push(d.promise),r(a.Id).then(function(f){if(!e){var g=[];a.Series=f.data.Records,_.forEach(a.Series,function(a){var b=s(a.Id).then(function(b){e||(a.Images=b.data.Records)},function(){e=!0,c.reject()});g.push(b)}),b.all(g).then(function(){d.resolve()})}},function(){e=!0,c.reject()})}),b.all(f).then(function(){c.resolve({Exams:d})})},function(){e=!0,c.reject()}),c.promise}function u(a){return k()+"bitmap/thumbnail/"+a}function v(a,b){var c="jpg";return _.isNullOrUndefined(b)||""===b||(c=b),j()+"external/bitmap?image="+a+"&encoding="+c}function w(a,b,c){var d=j()+"external/?patientid="+a.patientId+"&lastname="+a.lastName+"&firstname="+a.firstName+"&gender="+a.gender+"&birthdate="+a.birthDate+"&autoCapture="+b+"&autoClose="+c;console.log(d),window.open(d)}var x="https://",y="apteryx-imaging";return{seeIfProviderIsReady:h,getPatientByPDCOPatientId:l,getUrlForPatientByPatientId:m,getUrlForExamByExamId:n,getUrlForExamByPatientIdExamId:o,getUrlForPatientByImageId:p,getExamsByPatientId:q,getAllByPatientId:t,getImageThumbnailByImageId:u,getImageBitmapByImageId:v,captureImage:w,ClaimApiImagingVendor:"Apteryx"}}var b=angular.module("PatWebCoreV1");b.service("apteryxImagingService",a),a.$inject=["$http","$q","$window","IdmConfig","uriService","apteryxPatAuthenticationService","platformSessionService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){if(f.getIsLoggedIn()){var a=j();return b.resolve(a)}return f.loggingIn?f.loggingIn:(console.log("User is not logged in but attempted to load Apteryx 2.0"),b.reject())}function j(){if("true"===d.apteryxUsePracticeIdForSiteName.toLowerCase()){var a=g.getSessionStorage("userPractice");return null!==a?a.id:(console.log("Practice was not found with practiceId mode enabled so returning default configuration value"),d.apteryx2UrlSiteName)}return d.apteryx2UrlSiteName}function k(){var a=h.userContext.get();return a.Result.Application.ApplicationId}function l(){return z+j()+"."+d.apteryx2UrlPart+"/"}function m(){var a=l()+"api/";return a}function n(b){var c=m()+"patient/?primaryId="+b+k();return a.get(c)}function o(a){return l()+"?patient="+a}function p(a){return l()+"?study="+a}function q(a,b){return l()+"?patient="+a+"&study="+b}function r(a){return l()+"?image="+a}function s(b){var c=m()+"study/?patient="+b;return a.get(c)}function t(b){var c=m()+"series/?study="+b;return a.get(c)}function u(b){var c=m()+"image/?series="+b;return a.get(c)}function v(a){var c=b.defer(),d=[],e=!1;return s(a).then(function(a){var f=[];d=a.data.Records,_.forEach(d,function(a){var d=b.defer();f.push(d.promise),t(a.Id).then(function(f){if(!e){var g=[];a.Series=f.data.Records,_.forEach(a.Series,function(a){var b=u(a.Id).then(function(b){e||(a.Images=b.data.Records)},function(){e=!0,c.reject()});g.push(b)}),b.all(g).then(function(){d.resolve()})}},function(){e=!0,c.reject()})}),b.all(f).then(function(){c.resolve({Exams:d})})},function(){e=!0,c.reject()}),c.promise}function w(a){return m()+"bitmap/thumbnail/"+a}function x(a,b){var c="jpg";return null!==b&&void 0!==b&&""!==b&&(c=b),m()+"bitmap/"+a}function y(a,b,c){var d=a.patientId+k(),e=l()+"?patientid="+d+"&lastname="+a.lastName+"&firstname="+a.firstName+"&gender="+a.gender+"&birthdate="+a.birthDate+"&autocapture="+b+"&autoclose="+c;console.log(e),window.open(e)}var z="https://";return{seeIfProviderIsReady:i,getPatientByPDCOPatientId:n,getUrlForPatientByPatientId:o,getUrlForExamByExamId:p,getUrlForExamByPatientIdExamId:q,getUrlForPatientByImageId:r,getExamsByPatientId:s,getAllByPatientId:v,getImageThumbnailByImageId:w,getImageBitmapByImageId:x,captureImage:y,ClaimApiImagingVendor:"Apteryx_XVWeb2"}}var b=angular.module("PatWebCoreV1");b.service("apteryxImagingService2",a),a.$inject=["$http","$q","$window","IdmConfig","uriService","apteryxPatAuthenticationService2","platformSessionService","platformSessionCachingService"]}(),function(){"use strict";function a(a,b,c){function d(c){switch(_.isEmpty(c)&&(c=e()),c){case b.apteryx:return a.get("apteryxImagingService");case b.apteryx2:return a.get("apteryxImagingService2");default:return console.log("No Imaging Provider is turned on for this practice."),null}}function e(){var a=c.getSessionStorage("practiceImagingVendors");return _.some(a,{VendorId:3})?b.apteryx2:_.some(a,{VendorId:1})?b.apteryx:null}return{resolve:d}}angular.module("PatWebCoreV1").service("imagingProviderFactory",a),a.$inject=["$injector","ImagingProviders","platformSessionService"]}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.constant("ImagingProviders",{apteryx:"Apteryx",apteryx2:"Apteryx2"})}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){var b=c.defer(),d=h();return _.isEmpty(d)?b.resolve([]):a.get(i+"active/"+d.id).then(function(a){_.isEmpty(a)||_.isEmpty(a.data)||_.isEmpty(a.data.Result)||f.setSessionStorage("practiceImagingVendors",a.data.Result),b.resolve([])},function(a){b.reject(a)}),b.promise}function h(){return f.getSessionStorage("userPractice")}var i=e.getWebApiUri()+"/api/practiceImagingVendor/";return{getActivePracticeImagingVendors:g}}angular.module("PatWebCoreV1").service("practiceImagingVendorService",a),a.$inject=["$http","$window","$q","IdmConfig","uriService","platformSessionService"]}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("locationHeaderInterceptor",["$injector",function(a){return{request:function(b){if(1==b.noPatHeaders)return b;var c=a.get("locationService"),d=c.getCurrentLocation(),e=0;return null!=d&&(e=d.id),b.headers["PAT-Location-ID"]=e,b}}}]),a.config(["$httpProvider",function(a){a.interceptors.push("locationHeaderInterceptor")}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.directive("locationSelector",function(a,b,c){var d='<div><div class="btn-group" uib-dropdown keyboard-nav><button type="button" class="btn btn-primary" uib-dropdown-toggle tabindex="2">{{selectedLocationName}} <span class="top-nav-item"> change</span></button><ul class="dropdown-menu location-dropdown" uib-dropdown-menu role="menu"><li class="list-header" tabindex="-1">Change your login location</li><li role="menuitem" ng-repeat="location in practicelocations"><a tabindex="2" href="javascript:void(0)" ng-click="pickLocation(location)">{{location.name}}</a></li></ul></div></div>';return{scope:{sorter:"=sorter",practicelocations:"=?practiceLocations"},restrict:"E",template:d,bindToController:!1,controller:"locationSelectorController as $ctrl"}})}(),function(){angular.module("PatWebCoreV1").controller("locationSelectorController",["$rootScope","$scope","locationService","platformSessionService",function(a,b,c,d){function e(){c.getCurrentPracticeLocations().then(function(c){b.practicelocations?(b.practicelocations.length=0,void 0!==b.sorter&&c.sort(b.sorter),_.forEach(c,function(a){b.practicelocations.push(a)}),b.selectedLocationName=b.practicelocations[0].name,d.setSessionStorage("userLocation",b.practicelocations[0]),d.setSessionStorage("activeLocations",b.practicelocations),a.$broadcast("practiceAndLocationsLoaded")):(void 0!==b.sorter&&c.sort(b.sorter),b.practicelocations=c,b.selectedLocationName=b.practicelocations[0].name,d.setSessionStorage("userLocation",b.practicelocations[0]),d.setSessionStorage("activeLocations",b.practicelocations),a.$broadcast("practiceAndLocationsLoaded"))})["catch"](function(){b.selectedLocationName="Select a Practice"})}b.pickLocation=function(a){c.selectLocation(a),b.selectedLocationName=a.name,b.selectedLocation=_.cloneDeep(a),c.showAppHeaderWarning(a.deactivationTimeUtc)};var f=c.getCurrentLocation();f?(b.selectedLocationName=f.name,b.selectedLocation=_.cloneDeep(f),c.showAppHeaderWarning(f.deactivationTimeUtc)):b.selectedLocationName="Select item",b.$on("patCore:practiceAndLocationsLoaded",function(a,c){var e=d.getSessionStorage("userLocation");b.practicelocations=d.getSessionStorage("activeLocations"),null!==e&&(b.selectedLocationName=e.name,b.selectedLocation=e)}),b.$on("update-locations-dropdown",function(a,d){if(_.isNullOrUndefined(b.selectedLocation)){var f=c.getCurrentLocation();b.selectedLocation=_.cloneDeep(f)}d.LocationId===b.selectedLocation.id&&(b.selectedLocation.name=d.NameLine1,b.selectedLocation.deactivationTimeUtc=d.DeactivationTimeUtc,c.selectLocation(b.selectedLocation),c.showAppHeaderWarning(d.DeactivationTimeUtc)),e()}),b.$on("patCore:load-location-display",function(a,d){var e=c.getActiveLocations();e&&(b.practicelocations=e);var f=c.getCurrentLocation();b.selectedLocation=_.cloneDeep(f)});var g=c.getActiveLocations();if(null!==g){b.practicelocations=g;var h=c.getCurrentLocation();null!==f&&(b.selectedLocation=h)}}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("locationService",["$rootScope","$filter","$http","uriService","$q","locationmodel","platformSessionService","platformSessionCachingService",function(a,b,c,d,e,f,g,h){function i(b){var c=moment().format("MM/DD/YYYY"),d=moment(b).format("MM/DD/YYYY");b?moment(d).isBefore(c)||moment(d).isSame(c)?a.$broadcast("show-globalAppHeader",1):a.$broadcast("show-globalAppHeader",2):a.$broadcast("show-globalAppHeader",3)}function j(){var a=e.defer(),b=h.userContext.get();null===b&&e.reject("error occurred");var d=b.Result.Access;if(d){var i=w();i?c.get(p+i.id).then(function(b){var c=[];b.data.Result.forEach(function(a){var b=f.build(a.LocationId,a.Name,a.PracticeId,a.MerchantId,a.Description,a.Timezone,a.DeactivationTimeUtc);c.push(b)}),g.setSessionStorage("activeLocations",c),a.resolve(c)})["catch"](function(){return e.reject("error occurred.")}):e.reject("error occurred")}else e.reject("error occurred.");return a.promise}function k(){var a=w();return a?c.get(p+a.id).then(function(a){var b=[];return a.data.Result.forEach(function(a){var c=f.build(a.LocationId,a.Name,a.PracticeId,a.MerchantId,a.Description,a.Timezone,a.DeactivationTimeUtc);b.push(c)}),g.setSessionStorage("activeLocations",b),b}):e.resolve([])}function l(){switch(a.patAuthContext.accessLevel){case"RestrictedPractice":case"Location":return j();default:return k()}}function m(b){var c=w();if(null===c)throw Error("There is no practice selected");if(void 0===b)l().then(function(c){b=c[0],g.setSessionStorage("userLocation",b),a.$broadcast("patCore:initlocation")});else{for(var d=this.getActiveLocations(),e=0,f=d.length-1;f>=0;f--){var h=d[f];if(h.id===b.id){e=1,g.setSessionStorage("userLocation",b),a.$broadcast("patCore:initlocation");break}}0===e&&(console.log("For some unknown reason the location was not set after the various checks so change the value anyway."),g.setSessionStorage("userLocation",b),a.$broadcast("patCore:initlocation"))}}function n(a){g.setSessionStorage("userLocation",a)}function o(){var a=e.defer(),b=w();return null===b?e.reject(new Error("There is no practice selected")):(l().then(function(b){var c=b;c.sort(sortBy("name")),a.resolve(c)}),a.promise)}var p=d.getWebApiUri()+"/api/locations/practice/",q=function(){var a=e.defer(),b=w();return b?c.get(p+b.id+"/sorted").then(function(b){var c=[],d=[],e=[];b.data.Result.ActiveLocations.forEach(function(a){var b=f.build(a.LocationId,a.Name,a.PracticeId,a.MerchantId,a.Description,a.Timezone,a.DeactivationTimeUtc);c.push(b)}),g.setSessionStorage("activeLocationsSorted",c),b.data.Result.PendingLocations.forEach(function(a){var b=f.build(a.LocationId,a.Name,a.PracticeId,a.MerchantId,a.Description,a.Timezone,a.DeactivationTimeUtc);d.push(b)}),g.setSessionStorage("pendingLocationsSorted",d),b.data.Result.InactiveLocations.forEach(function(a){var b=f.build(a.LocationId,a.Name,a.PracticeId,a.MerchantId,a.Description,a.Timezone,a.DeactivationTimeUtc);e.push(b)}),g.setSessionStorage("inactiveLocationsSorted",e),a.resolve([c,d,e])})["catch"](function(){return e.reject("error occurred")}):a.resolve({}),a.promise},r=function(){return g.getSessionStorage("userLocation")},s=function(){return g.getSessionStorage("activeLocations")},t=function(){return g.getSessionStorage("activeLocationsSorted")},u=function(){return g.getSessionStorage("pendingLocationsSorted")},v=function(){return g.getSessionStorage("inactiveLocationsSorted")},w=function(){return g.getSessionStorage("userPractice")};return{getAllLocations:l,selectLocation:m,setLocation:n,getCurrentLocation:r,getActiveLocations:s,getCurrentPracticeLocations:o,showAppHeaderWarning:i,getLocationsSorted:q,getActiveLocationsSorted:t,getPendingLocationsSorted:u,getInactiveLocationsSorted:v}}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("locationmodel",function(){function a(a,b,c,d,e,f,g){this.id=a,this.name=b,this.practiceid=c,this.merchantid=d,this.description=e,this.timezone=f,this.deactivationTimeUtc=g}return a.build=function(b,c,d,e,f,g,h){return new a(b,c,d,e,f,g,h)},a})}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.directive("sortedLocationSelector",function(a,b){var c='<div><div class="btn-group" uib-dropdown keyboard-nav><button type="button" class="btn btn-primary" uib-dropdown-toggle tabindex="2">{{selectedLocationName}} <span class="top-nav-item">Change Location</span></button><ul class="dropdown-menu location-dropdown" uib-dropdown-menu role="menu"><li class="list-header" tabindex="-1"><b>Active Locations</b></li><li role="menuitem" ng-repeat="location in activeLocationsSorted"><a tabindex="2" href="javascript:void(0)" ng-click="pickLocation(location)">{{location.name}}</a></li><li class="list-header" tabindex="-1"><b>Pending Locations</b></li><li role="menuitem" ng-repeat="location in pendingLocationsSorted"> <a tabindex="2" href="javascript:void(0)" ng-click="pickLocation(location)">{{location.name}} - {{formatDate(location.deactivationTimeUtc)}}</a></li><li class="list-header" tabindex="-1"><b>Inactive Locations</b></li><li role="menuitem" ng-repeat="location in inactiveLocationsSorted"> <a tabindex="2" href="javascript:void(0)" ng-click="pickLocation(location)">{{location.name}} - {{formatDate(location.deactivationTimeUtc)}}</a></li></ul></div></div>';return{template:c,bindToController:!0,controller:"sortedLocationSelectorController as $ctrl"}})}(),function(){angular.module("PatWebCoreV1").controller("sortedLocationSelectorController",function(a,b,c){function d(){c.getLocationsSorted().then(function(a){b.activeLocationsSorted=c.getActiveLocationsSorted(),b.pendingLocationsSorted=c.getPendingLocationsSorted(),b.inactiveLocationsSorted=c.getInactiveLocationsSorted()})}b.pickLocation=function(a){c.selectLocation(a),b.selectedLocationName=a.name,b.selectedLocation=_.cloneDeep(a),c.showAppHeaderWarning(a.deactivationTimeUtc)};var e=c.getCurrentLocation();e?(b.selectedLocationName=e.name,b.selectedLocation=_.cloneDeep(e),c.showAppHeaderWarning(e.deactivationTimeUtc)):b.selectedLocationName="Select item",b.formatDate=function(a){return moment(a).format("MM/DD/YYYY")},d()})}(),function(a,b,c){"use strict";b.module("ngIdle",["ngIdle.keepalive","ngIdle.idle","ngIdle.countdown","ngIdle.title","ngIdle.localStorage"]),b.module("ngIdle.keepalive",[]).provider("Keepalive",function(){var a={http:null,interval:600};this.http=function(c){if(!c)throw new Error("Argument must be a string containing a URL, or an object containing the HTTP request configuration.");b.isString(c)&&(c={url:c,method:"GET"}),c.cache=!1,a.http=c};var c=this.interval=function(b){if(b=parseInt(b),isNaN(b)||b<=0)throw new Error("Interval must be expressed in seconds and be greater than 0.");a.interval=b};this.$get=["$rootScope","$log","$interval","$http",function(d,e,f,g){function h(a){d.$broadcast("KeepaliveResponse",a.data,a.status)}function i(){d.$broadcast("Keepalive"),b.isObject(a.http)&&g(a.http).then(h)["catch"](h)}var j={ping:null};return{_options:function(){return a},setInterval:c,start:function(){return f.cancel(j.ping),j.ping=f(i,1e3*a.interval),j.ping},stop:function(){f.cancel(j.ping)},ping:function(){i()}}}]}),b.module("ngIdle.idle",["ngIdle.keepalive","ngIdle.localStorage"]).provider("Idle",function(){var a={idle:1200,timeout:30,autoResume:"idle",interrupt:"mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove scroll",keepalive:!0},c=this.timeout=function(c){if(c===!1)a.timeout=0;else{if(!(b.isNumber(c)&&c>=0))throw new Error("Timeout must be zero or false to disable the feature, or a positive integer (in seconds) to enable it.");a.timeout=c}};this.interrupt=function(b){a.interrupt=b};var d=this.idle=function(b){if(b<=0)throw new Error("Idle must be a value in seconds, greater than 0.");a.idle=b};this.autoResume=function(b){b===!0?a.autoResume="idle":b===!1?a.autoResume="off":a.autoResume=b},this.keepalive=function(b){a.keepalive=b===!0},this.$get=["$interval","$log","$rootScope","$document","Keepalive","IdleLocalStorage","$window",function(e,f,g,h,i,j,k){function l(){a.keepalive&&(v.running&&i.ping(),i.start())}function m(){a.keepalive&&i.stop()}function n(){v.idling=!v.idling;var b=v.idling?"Start":"End";g.$broadcast("Idle"+b),v.idling?(m(),a.timeout&&(v.countdown=a.timeout,o(),v.timeout=e(o,1e3,a.timeout,!1))):l(),e.cancel(v.idle)}function o(){return v.countdown<=0?void p():(g.$broadcast("IdleWarn",v.countdown),void v.countdown--)}function p(){m(),e.cancel(v.idle),e.cancel(v.timeout),v.idling=!0,v.running=!1,v.countdown=0,g.$broadcast("IdleTimeout")}function q(a,b,c){var d=a.running();a.unwatch(),b(c),d&&a.watch()}function r(){var a=j.get("expiry");return a&&a.time?new Date(a.time):null}function s(a){a?j.set("expiry",{id:w,time:a}):j.remove("expiry")}var t,u,v={idle:null,timeout:null,idling:!1,running:!1,countdown:null},w=(new Date).getTime(),x={_options:function(){return a},_getNow:function(){return new Date},getIdle:function(){return a.idle},getTimeout:function(){return a.timeout},setIdle:function(a){q(this,d,a)},setTimeout:function(a){q(this,c,a)},isExpired:function(){var a=r();return null!==a&&a<=this._getNow()},running:function(){return v.running},idling:function(){return v.idling},watch:function(b){e.cancel(v.idle),e.cancel(v.timeout);var c=a.timeout?a.timeout:0;b||s(new Date((new Date).getTime()+1e3*(a.idle+c))),v.idling?n():v.running||l(),v.running=!0,v.idle=e(n,1e3*a.idle,0,!1)},unwatch:function(){e.cancel(v.idle),e.cancel(v.timeout),v.idling=!1,v.running=!1,s(null),m()},interrupt:function(b){if(v.running)return a.timeout&&this.isExpired()?void p():void(("idle"===a.autoResume||"notIdle"===a.autoResume&&!v.idling)&&this.watch(b))}};h.find("body").on(a.interrupt,function(a){if(a.clientX){if(t===a.clientX&&u===a.clientY)return;t=a.clientX,u=a.clientY}x.interrupt()});var y=function(a){if("ngIdle.expiry"===a.key&&a.newValue!==a.oldValue){var c=b.fromJson(a.newValue);if(c.id===w)return;x.interrupt(!0)}};return k.addEventListener?k.addEventListener("storage",y,!1):k.attachEvent("onstorage",y),x}]}),b.module("ngIdle.countdown",["ngIdle.idle"]).directive("idleCountdown",["Idle",function(a){return{restrict:"A",scope:{value:"=idleCountdown"},link:function(b){b.value=a.getTimeout(),b.$on("IdleWarn",function(a,c){b.$evalAsync(function(){b.value=c})}),b.$on("IdleTimeout",function(){b.$evalAsync(function(){b.value=0})})}}}]),b.module("ngIdle.title",[]).factory("Title",["$document","$interpolate",function(a,c){function d(a,b,c){return new Array(b-String(a).length+1).join(c||"0")+a}var e={original:null,idle:"{{minutes}}:{{seconds}} until your session times out!",timedout:"Your session has expired."};return{original:function(a){return b.isUndefined(a)?e.original:void(e.original=a)},store:function(a){!a&&e.original||(e.original=this.value())},value:function(c){return b.isUndefined(c)?a[0].title:void(a[0].title=c)},idleMessage:function(a){return b.isUndefined(a)?e.idle:void(e.idle=a)},timedOutMessage:function(a){return b.isUndefined(a)?e.timedout:void(e.timedout=a)},setAsIdle:function(a){this.store();var b={totalSeconds:a};b.minutes=Math.floor(a/60),b.seconds=d(a-60*b.minutes,2),this.value(c(this.idleMessage())(b))},setAsTimedOut:function(){this.store(),this.value(this.timedOutMessage())},restore:function(){this.original()&&this.value(this.original())}}}]).directive("title",["Title",function(a){return{restrict:"E",link:function(b,c,d){d.idleDisabled||(a.store(!0),b.$on("IdleStart",function(){a.original(c[0].innerText)}),b.$on("IdleWarn",function(b,c){a.setAsIdle(c)}),b.$on("IdleEnd",function(){a.restore()}),b.$on("IdleTimeout",function(){a.setAsTimedOut()}))}}}]),b.module("ngIdle.localStorage",[]).service("IdleLocalStorage",["$window",function(a){var c=a.localStorage;return{set:function(a,d){c.setItem("ngIdle."+a,b.toJson(d))},get:function(a){return b.fromJson(c.getItem("ngIdle."+a))},remove:function(a){c.removeItem("ngIdle."+a)}}}])}(window,window.angular),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("openEdgeService",["$rootScope","$http","$window","OPENEDGE_API_URL","locationService","practiceService",function(a,b,c,d,e,f){function g(a,c,e,f){var g={PayerAccountId:a,MerchantId:o(),EntryMode:c,Amount:e,RequireSignature:f};return null==g.MerchantId?Promise.reject(new Error("No merchant id found!")):b({method:"POST",url:d+"/credit",data:g})}function h(a,c,e,f,g){var h={PayerAccountId:a,MerchantId:o(),EntryMode:c,Amount:e,RequireSignature:f,AccountType:g};return null==h.MerchantId?Promise.reject(new Error("No merchant id found!")):b({method:"POST",url:d+"/debitpurchase",data:h})}function i(a,c,e,f,g){var h={PayerAccountId:a,MerchantId:o(),EntryMode:c,Amount:e,RequireSignature:f,AccountType:g};return null==h.MerchantId?Promise.reject(new Error("No merchant id found!")):b({method:"POST",url:d+"/debitrefund",data:h})}function j(a,c){var e={OrderId:a,Amount:c};return b({method:"POST",url:d+"/adjust",data:e})}function k(a){var c={OrderId:a};return b({method:"POST",url:d+"/void",data:c})}function l(a,b){var e="<html><head></head><body>";e+="<h3>Credit transaction in progress...</h3>",e+='<form id=submitCredit method="post" action="'+d+'/submit">',e+='<input name="TransactionId" type="hidden" value="'+a+'">',e+='<script> document.getElementById("submitCredit").submit();</script>',e+="</form></body></html>";var f="top=0,width=400,height="+b,g=c.open("","OpenEdge",f);return null!=g&&(g.document.write(e),!0)}function m(a){return b({method:"GET",url:d+"/"+a})}function n(a){return b({method:"GET",url:d+"/details/"+a})}function o(){var a=e.getCurrentLocation();if(null!=a&&a.merchantid)return a.merchantid;var b=f.getCurrentPractice();return b&&b.merchantID?b.merchantID:null}return{createCredit:g,createDebitPurchase:h,createDebitRefund:i,submitTransaction:l,adjustTransaction:j,voidTransaction:k,getTransaction:m,getTransactionDetails:n}}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("webshellOptionalFeatures",function(){const a="walkMe.js";return{loadWalkme:function(){var b=document.getElementById(a);if(!b){var c=document.createElement("script");c.id=a,c.type="text/javascript",c.async=!0,c.src=window.walkmeUrl;var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d),window._walkmeConfig={smartLoad:!0}}}}})}(),function(){"use strict";function a(){function a(a,b){var c=[];return _.forEach(a,function(a){c.push(a)}),c.sort(function(a,c){return a[b]>c[b]?1:-1}),c}return a}angular.module("PatWebCoreV1").filter("orderObjectBy",a)}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.directive("pdf",function(a,b,c,d,e,f,g,h){function i(a,b,c){function d(){if(!a.src)return void b.replaceWith("Error: Can't retrieve PDF.  The src attribute is missing.");var c=a.height?a.height:"100%",d=a.width?a.width:"100%";j(a.src).then(function(a){
b.html('<object type="application/pdf" data="'+a+'" width="'+d+'" height="'+c+'"></object>')},function(){b.replaceWith("Error: Can't retrieve PDF.  There was an error formulating the PDF url.")})}a.$watchCollection("[src, height, width]",d)}function j(f){var i=a.getCurrentPractice(),j=0;null!=i&&(j=i.id);var k=b.getApplicationId(),l=c.getCurrentLocation(),m=0;null!=l&&(m=l.id);var n=d.getId(),o=e.getIdentifier();return g({withCredentials:!0,method:"GET",url:h+"/api/v1/locations/"+m+"/j430dclaims/pdfSetup"}).then(function(a,b,c,d){return f+"?PAT-Practice-ID="+j+"&PAT-Location-ID="+m+"&PAT-Application-ID="+k+"&PAT-Request-ID="+n+"&PAT-Application-Instance-ID="+o},function(a){throw console.log(a),a})}return{restrict:"E",scope:{src:"@",height:"@",width:"@"},link:i}})}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("practiceHeaderInterceptor",["$injector","platformSessionCachingService",function(a,b){return{request:function(c){if(c.noPatHeaders===!0)return c;var d=a.get("practiceService"),e=d.getCurrentPractice(),f=0;null!==e&&(f=e.id);var g=b.userContext.get();if(null!==g){var h=g.Result.User;2===h.AccessLevel&&(f=h.AccessLevelId)}return c.headers["PAT-Practice-ID"]=f,c}}}]),a.config(["$httpProvider",function(a){a.interceptors.push("practiceHeaderInterceptor")}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.directive("practiceSelector",function(a,b){var c='<div ><div class="btn-group" dropdown keyboard-nav><button type="button" class="btn btn-primary" data-toggle="dropdown">{{selectedPracticeName}}<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li role="menuitem" ng-repeat="practice in practices | orderBy:-name"><a href="javascript:void(0)" ng-click="pickPractice(practice)">{{practice.name}}</a></li></ul></div></div>';return{scope:{practices:"@"},restrict:"E",template:c,bindToController:!0,controller:"practiceSelectorController as $ctrl"}})}(),function(){angular.module("PatWebCoreV1").controller("practiceSelectorController",function(a,b){function c(){b.getPractices().then(function(b){a.practices=b,a.selectedPracticeName=a.practices[0].name})}a.pickPractice=function(c){c.name!==a.selectedPracticeName&&(b.selectPractice(c),a.selectedPracticeName=c.name)};var d=b.getCurrentPractice();d?a.selectedPracticeName=d.name:a.selectedPracticeName="Select item",c()})}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("practiceService",["$rootScope","$filter","$http","uriService","$q","practicemodel","locationService","practiceImagingVendorService","platformSessionService","imagingProviderFactory","tokenSyncService","platformSessionCachingService",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){var a=e.defer(),b=d.getWebApiUri()+"/api/practices";return c.get(b).then(function(b){var c=[];b.data.Result.forEach(function(a){var b=f.build(a.PracticeId,a.Name,a.CustomerId,a.PrimaryContactName,a.PrimaryContactAddress1,a.PrimaryContactAddress2,a.PrimaryContactCity,a.PrimaryContactStateProvince,a.PrimaryContactPostalCode,a.PrimaryContactPhone1,a.PrimaryContactPhone2,a.SecondaryContactPhone1,a.MerchantId);c.push(b)}),a.resolve(c)})["catch"](function(){return e.reject("error occurred.")}),a.promise}function n(){var a=e.defer(),b=l.userContext.get();null===b&&e.reject("error occurred");var g=b.Result.User;if(g){var h=g.AccessLevelId;0===h&&(h=b.Result.Access[0].Id),c.get(d.getWebApiUri()+"/api/locations/"+h).then(function(b){var g=b.data.Result,h=d.getWebApiUri()+"/api/practices/"+g.PracticeId;c.get(h).then(function(b){var c=b.data.Result,d=f.build(c.PracticeId,c.Name,c.CustomerId,c.PrimaryContactName,c.PrimaryContactAddress1,c.PrimaryContactAddress2,c.PrimaryContactCity,c.PrimaryContactStateProvince,c.PrimaryContactPostalCode,c.PrimaryContactPhone1,c.PrimaryContactPhone2,c.SecondaryContactPhone1,c.MerchantId);a.resolve(d)})["catch"](function(){return e.reject("error occurred.")})})["catch"](function(){return e.reject("error occurred.")})}else e.reject("error occurred.");return a.promise}function o(){var a=e.defer(),b=l.userContext.get();if(null===b)return e.reject("error occurred");var g=b.Result.User;if(!g)return e.reject("error occurred.");var h=g.AccessLevelId;0===h&&(h=b.Result.Access[0].Id);var i=[];return c.get(d.getWebApiUri()+"/api/locations/"+h).then(function(b){var g=b.data.Result,h=d.getWebApiUri()+"/api/practices/"+g.PracticeId;c.get(h).then(function(b){var c=b.data.Result,d=f.build(c.PracticeId,c.Name,c.CustomerId,c.PrimaryContactName,c.PrimaryContactAddress1,c.PrimaryContactAddress2,c.PrimaryContactCity,c.PrimaryContactStateProvince,c.PrimaryContactPostalCode,c.PrimaryContactPhone1,c.PrimaryContactPhone2,c.SecondaryContactPhone1,c.MerchantId);i.push(d),a.resolve(i)})["catch"](function(){return e.reject("error occurred.")})})["catch"](function(){return e.reject("error occurred.")}),a.promise}function p(){h.getActivePracticeImagingVendors().then(function(a){var b=j.resolve();null!==b&&b.seeIfProviderIsReady().then(function(a){},function(a){})},function(a){})}function q(){var a=e.defer(),b=l.userContext.get();if(null===b||null===b.Result||null===b.Result.User)return e.reject("error occurred");var g=[],h=d.getWebApiUri()+"/api/practices/"+b.Result.User.AccessLevelId;return c.get(h).then(function(b){var c=b.data.Result,d=f.build(c.PracticeId,c.Name,c.CustomerId,c.PrimaryContactName,c.PrimaryContactAddress1,c.PrimaryContactAddress2,c.PrimaryContactCity,c.PrimaryContactStateProvince,c.PrimaryContactPostalCode,c.PrimaryContactPhone1,c.PrimaryContactPhone2,c.SecondaryContactPhone1,c.MerchantId);g.push(d),a.resolve(g)})["catch"](function(){return e.reject("error occurred.")}),a.promise}function r(b){var c=i.getSessionStorage("userPractice");b!=c&&(i.setSessionStorage("userPractice",b),p(),g.getAllLocations().then(function(b){i.setSessionStorage("userLocation",b[0]),i.setSessionStorage("activeLocations",b),a.$broadcast("patCore:initpractice"),a.$broadcast("patCore:practiceAndLocationsLoaded")},function(a){}))}function s(b){var c=f.build(b,c);i.setSessionStorage("userPractice",c),a.$broadcast("patCore:initpractice"),p()}var t=function(){var b=e.defer();return"Enterprise"===a.patAuthContext.accessLevel||"RestrictedEnterprise"===a.patAuthContext.accessLevel?m().then(function(a){r(a[0]),b.resolve(a)}):"Practice"===a.patAuthContext.accessLevel?q().then(function(a){r(a[0]),b.resolve(a)}):o().then(function(a){r(a[0]),b.resolve(a)}),b.promise},u=function(){return i.getSessionStorage("userPractice")};return{getPractices:t,getPracticeWhenItIsNotSet:n,selectPractice:r,getCurrentPractice:u,selectPracticeById:s}}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("practicemodel",function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this.id=a,this.name=b,this.merchantID=m,this.custID=c,this.contactName=d,this.address1=e,this.address2=f,this.city=g,this.stateProvince=h,this.postalCode=i,this.phone1=j,this.phone2=k,this.fax=l,this.timezone=n}return a.build=function(b,c,d,e,f,g,h,i,j,k,l,m,n,o){return new a(b,c,d,e,f,g,h,i,j,k,l,m,n,o)},a})}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){var i=d.addEventListener?"addEventListener":"attachEvent",j=d[i],k="attachEvent"===i?"onmessage":"message";j(k,function(a){"Login Process Completed"===a.data})}angular.module("PatWebCoreV1").service("tokenSyncService",a),a.$inject=["$rootScope","$http","$q","$window","IdmConfig","uriService","patAuthenticationService","platformSessionService"]}(),function(){"use strict";angular.module("PatWebCoreV1").controller("manageSessionModalController",["$scope","$uibModalInstance","Idle",function(a,b,c){a.ok=function(){c.watch(),b.close()},a.$on("patwebcore:idleEnd",function(){b.close()})}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("manageSession",["$rootScope","Idle","patSecurityService","monitorLogoutService",function(a,b,c,d){function e(){b.watch()}return a.$on("IdleStart",function(){a.$emit("patwebcore:idleTimeout")}),a.$on("IdleEnd",function(){a.$broadcast("patwebcore:idleEnd")}),a.$on("IdleTimeout",function(){c.logout()}),window===window.parent&&d.onExternalLogout(function(){c.logout()}),{startIdle:e}}])}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.directive("signature",function(){return{template:'<div ng-show="vm.isSignaturePageLoaded"><div id="signature-pad" class="m-signature-pad" ng-show="!vm.isTopazRunning && !vm.isTopazProblem"><div class="m-signature-pad--body"><canvas id="mouse-touch-cnv" style="border:1px solid #000000;"></canvas></div><div class="m-signature-pad--footer"><div class="description">Sign above with mouse or touchpad</div><button type="button" ng-click="vm.onSaveMouseTouch()" ng-show="vm.enableSave">Save</button><button type="button" ng-click="vm.onLoadMouseTouch()" ng-show="vm.enableLoad">Load</button><button type="button" ng-click="vm.onClearMouseTouch()">Clear</button><signature-file get-sig="vm.getMouseTouchSig" set-sig="vm.setMouseTouchSig" clear-sig="vm.clearMouseTouchSig"></signature-file></div></div><div id="topaz-signature" class="m-topaz-signature" ng-show="vm.isTopazRunning"><div class="m-topaz-body"><canvas id="topaz-cnv" name="topaz-cnv" width="500" height="100" style="border:1px solid #000000;"></canvas></div><div class="m-topaz-footer"><button type="button" ng-click="vm.onSignTopaz()" ng-show="!vm.isSigningTopaz">Sign Topaz Pad</button><button type="button" ng-click="vm.onDoneSigningTopaz()" ng-show="vm.isSigningTopaz">Done Signing</button><button type="button" ng-click="vm.onSaveTopaz()" ng-show="vm.enableSave">Save</button><button type="button" ng-click="vm.onLoadTopaz()" ng-show="vm.enableLoad">Load</button><button type="button" ng-click="vm.onClearTopaz()">Clear</button></div></div><div id="topaz-problem" ng-show="vm.isTopazProblem"><label>Unable to establish communication with Topaz SigWeb Tablet Service</label><button type="button" ng-click="vm.onLoad()">Retry</button></div></div>',restrict:"E",scope:{sigWidth:"@",sigHeight:"@",sigType:"@",enableLoad:"=",enableSave:"=",loadSigData:"&",saveSigData:"&"},controller:"signatureDirectiveController",controllerAs:"vm",bindToController:!0,link:function(a,b,c,d){a.$parent.clearSignature=function(){d.isTopazRunning?d.onClearTopaz():d.onClearMouseTouch()}}}})}(),function(){angular.module("PatWebCoreV1").controller("signatureDirectiveController",function(a){var b=this;b.myImage=null,b.isTopazProblem=!1,b.topazCanvas=document.getElementById("topaz-cnv"),b.topazCanvas.width=500,b.topazCanvas.height=100,b.isTopazEmpty=!0,b.mouseTouchCanvas=document.getElementById("mouse-touch-cnv"),b.mouseTouchPad=new SignaturePad(b.mouseTouchCanvas),b.isSignaturePageLoaded=!1,b.alertError=function(a){toastr.options={positionClass:"toast-top-right"},toastr.error("Error! "+a.statusText)},b.onSignTopaz=function(){b.topazCanvas.width=500,b.topazCanvas.height=100,a.SetJustifyMode(0,function(){a.ClearTablet(b.alertError),b.tmr=a.SetTabletState(1,b.topazCanvas.getContext("2d"),100,b),b.isSigningTopaz=!0},b.alertError)},b.onResetTopazState=function(){b.isSigningTopaz&&(b.topazCanvas.width=500,b.topazCanvas.height=100,a.ClearTablet(b.alertError),a.SetTabletState(0,b.tmr,100,b),b.isSigningTopaz=!1)},b.onDoneSigningTopaz=function(){b.onResetTopazState()},b.onClearTopaz=function(){if(b.isTopazRunning){b.topazCanvas.width=500,b.topazCanvas.height=100,a.ClearTablet();var c=b.topazCanvas.getContext("2d");c.fillStyle="rgba(0,0,0,0)",c.clearRect(0,0,500,100),c.fillRect(0,0,500,100),b.isTopazEmpty=!0}},b.onSaveTopaz=function(){return b.isTopazEmpty?(toastr.options={positionClass:"toast-top-right"},toastr.error("Please sign before saving."),null):void b.saveSigData({data:b.topazCanvas.toDataURL()})},b.onLoadTopaz=function(){b.loadSigData().then(function(a){b.myImage=new Image,b.myImage.src=a.data,b.myImage.onload=function(){b.topazCanvas.width=b.myImage.naturalWidth,b.topazCanvas.height=b.myImage.naturalHeight,b.topazCanvas.getContext("2d").drawImage(b.myImage,0,0)},b.isTopazEmpty=!1},function(a){toastr.options={positionClass:"toast-top-right"},toastr.error("Error loading file "+a.statusText)})},b.resizeMouseTouchCanvas=function(){var a=Math.max(window.devicePixelRatio||1,1),c="undefined"==b.sigWidth?500:b.sigWidth,d="undefined"==b.sigHeight?100:b.sigHeight;b.mouseTouchCanvas.width=c*a,b.mouseTouchCanvas.height=d*a,b.mouseTouchCanvas.getContext("2d").scale(a,a)},b.onClearMouseTouch=function(){b.mouseTouchPad.clear()},b.onSaveMouseTouch=function(){return b.mouseTouchPad.isEmpty()?(toastr.options={positionClass:"toast-top-right"},toastr.error("Please sign before saving."),null):void b.saveSigData({data:b.mouseTouchPad.toDataURL("image/png",1)})},b.onLoadMouseTouch=function(){b.loadSigData().then(function(a){b.myImage=new Image,b.myImage.src=a.data,b.myImage.onload=new function(){b.sigWidth=b.myImage.naturalWidth,b.sigHeight=b.myImage.naturalHeight,b.resizeMouseTouchCanvas()},b.mouseTouchPad.fromDataURL(a.data)},function(a){toastr.options={positionClass:"toast-top-right"},toastr.error("Error loading file "+a.statusText)})},b.setupSignature=function(a){b.isTopazRunning=a,a?(b.tmr=null,b.isTopazProblem=!1,b.isSigningTopaz=!1,window.onunload=window.onbeforeunload=b.onResetTopazState):"Topaz"==b.sigType?b.isTopazProblem=!0:(window.onresize=b.resizeMouseTouchCanvas,b.resizeMouseTouchCanvas()),b.isSignaturePageLoaded=!0},b.onLoad=function(){"MouseTouch"==b.sigType?(b.isTopazRunning=!1,window.onresize=b.resizeMouseTouchCanvas,b.resizeMouseTouchCanvas(),b.isSignaturePageLoaded=!0):(b.isTopazRunning=void 0,a.TabletConnectQuery(b.setupSignature))},b.$onInit=function(){window.onload=b.onLoad()}})}(),function(){"use strict";var a=angular.module("PatWebCoreV1");a.factory("topazTabletService",["$rootScope","$q","$http","TOPAZ_URL",function(a,b,c,d){function e(a,b,d){c({method:"POST",url:v+a,noPatHeaders:!0}).then(function(a){null!=b&&b(a)},function(a){null!=d&&d(a)})}function f(a,d){var e=b.defer();return c({method:"GET",url:v+a,noPatHeaders:!0}).then(function(a){e.resolve(a.data)},function(b){toastr.options={positionClass:"toast-top-right"},toastr.error(a+" failed! - "+b.statusText)}),e.promise}function g(a){r=a}function h(){c({method:"GET",url:v+"TotalPoints",noPatHeaders:!0}).then(function(a){var b=a.data;b!=w&&(b>w&&s&&(s.isTopazEmpty=!1),w=b,c({method:"GET",url:v+"SigImage/0",responseType:"blob",noPatHeaders:!0}).then(function(a){var b=new Image;b.src=t(a.data),b.onload=function(){r.drawImage(b,0,0),u(this.src),b=null}}))})}function i(a){var b="ClearSignature";return b=b,f(b,a)}function j(a){var b="TotalPoints";return b=b,f(b,a)}function k(a,b,c){var d="JustifyMode/";d+=a,e(d,b,c)}function l(a,b,c){var d="DisplayXSize/";d+=a,e(d,b,c)}function m(a,b,c){var d="DisplayYSize/";d+=a,e(d,b,c)}function n(a,b,c){var d="TabletState/";d+=a,e(d,b,c)}function o(a){var b="TabletState";return b=b,f(b,a)}function p(a){return c({method:"GET",url:v+"TabletConnectQuery",noPatHeaders:!0}).then(function(b){a(!0)},function(b){a(!1)})}function q(a,b,c,d){var e;if(d&&(s=d),e=c?c:100,o()!=a){if(1==a){if(b){var f=b.canvas;l(f.width),m(f.height),g(b)}if(n(a),b)var i=setInterval(h,e);else var i=null;return i}b&&clearInterval(b),g(null),n(a)}return null}var r,s,t=window.URL&&URL.createObjectURL.bind(URL)||window.webkitURL&&webkitURL.createObjectURL.bind(webkitURL)||window.createObjectURL,u=window.URL&&URL.revokeObjectURL.bind(URL)||window.webkitURL&&webkitURL.revokeObjectURL.bind(webkitURL)||window.revokeObjectURL,v=d,w=0;return{ClearTablet:i,SetTabletState:q,NumberOfTabletPoints:j,SetJustifyMode:k,TabletConnectQuery:p}}])}();
//# sourceMappingURL=core-v1.0.min.js.map